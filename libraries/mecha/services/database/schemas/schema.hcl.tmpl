// vim: set filetype=hcl:
// Generated Atlas HCL from JSON Schema

schema "public" {
  comment = "Standard PostgreSQL public schema"
}

{{- $data := (datasource "data") -}}
{{- range $entity := $data.entities }}
table "{{ $entity.name }}" {
  schema = schema.public
  column "id" {
    type = uuid
    null = false
    default = sql("uuidv7()")
  }
  column "createdAt" {
    type = timestamptz
    null = false
    default = sql("NOW()")
  }
  column "updatedAt" {
    type = timestamptz
    null = false
    default = sql("NOW()")
  }
{{- range $propName, $propSchema := $entity.schema.properties }}
{{- if and (ne $propName "id") (ne $propName "createdAt") (ne $propName "updatedAt") (ne $propName "created_at") (ne $propName "updated_at") }}
  column "{{ $propName }}" {
{{- if eq $propSchema.type "string" }}
    type = varchar({{ $propSchema.maxLength | default 255 }})
{{- else if eq $propSchema.type "integer" }}
    type = integer
{{- else if eq $propSchema.type "number" }}
    type = decimal
{{- else if eq $propSchema.type "boolean" }}
    type = boolean
{{- else }}
    type = text
{{- end }}
    null = false
{{- if $propSchema.default }}
    default = "{{ $propSchema.default }}"
{{- end }}
  }
{{- end }}
{{- end }}

  primary_key {
    columns = [column.id]
  }
}
{{ end }}

// TODO: Future CEL validation via pg_jsonschema extension
// Complex validation patterns from protobuf CEL expressions will be added here
// when pg_jsonschema integration is implemented

// TODO: Add indexes and triggers
// Atlas syntax needs investigation for indexes and triggers